<html>
<head>
<meta name = "viewport" content = "width = device-width, user-scalable=no">  
  <style>
  
  #canvas {
  border: 1px solid black;	  
  }
  
  #farben {
	  width: 600px;
  }
  
  #schwarz {
	 height: 100px;
	 width: 100px;
	 background-color: #000;
	 display: inline;
	 float: left;
  }
  
  #rot {
	 height: 100px;
	 width: 100px;
	 background-color: #CC3227;
	 display: inline;
	 float: left; 
  }
  
  #blau {
	 height: 100px;
	 width: 100px;
	 background-color: #21A6CC;
	 display: inline;
	 float: left;
  }
  
  #rosa {
	 height: 100px;
	 width: 100px;
	 background-color: #CC144E;
	 display: inline;
	 float: left;
  }
  
  #gruen {
	 height: 100px;
	 width: 100px;
	 background-color: #8EFF82;
	 display: inline;
	 float: left;
  }
  
  #loeschen {
	  height: 80px;
	  width: 120px;
	  margin: 10px;
  }
  
   #speichern {
	  height: 80px;
	  width: 120px;
	  margin: 10px;
  }
  
  
  </style>
</head>
<body>

	<div id="farben">
		<div id="schwarz"></div>
		<div id="rot"></div>
		<div id="blau"></div>
		<div id="rosa"></div>
		<div id="gruen"></div>
	</div>
	
	<canvas id="canvas" width="600" height="600"></canvas>
	
	<input type="button" name="loeschen" id="loeschen" value="löschen"/>
	<input type="button" name="speichern" id="speichern" value="speichern"/>
	


	
 <script>
  
  	var farbe = "#44aa22";
  	
  	
    // requestanimationframe shim
	(function() {
	    var lastTime = 0;
	    var vendors = ['ms', 'moz', 'webkit', 'o'];
	    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
	        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
	        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame']
	                                   || window[vendors[x]+'CancelRequestAnimationFrame'];
	    }
	 
	    if (!window.requestAnimationFrame)
	        window.requestAnimationFrame = function(callback, element) {
	            var currTime = new Date().getTime();
	            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
	            var id = window.setTimeout(function() { callback(currTime + timeToCall); },
	              timeToCall);
	            lastTime = currTime + timeToCall;
	            return id;
	        };
	 
	    if (!window.cancelAnimationFrame)
	        window.cancelAnimationFrame = function(id) {
	            clearTimeout(id);
	        };
	}());
	
	// Scrollen ausschalten
	document.body.addEventListener('touchstart', function(e){ e.preventDefault(); });
	
	
	(function() {
	
	    var canvas;
	    var ctx;
	    var points = [];  // array für alle punkte
	    var mouseDown = false;
	    
	    var width;
	    var height;
	    
	    var img;

      var malvorlage = "apfel.png";
	
	    function init() {
	       canvas = document.getElementById("canvas");
	       
	       // Groesse
	       width = canvas.width;
	       height = canvas.height;
	       
	       // event listeners Touch Canvas
	       canvas.addEventListener("touchstart", downHandler); 
	       canvas.addEventListener("touchmove", moveHandler); 
	       canvas.addEventListener("touchend", upHandler);
	       
	       // event listener Touch Farben wählen
	       document.getElementById("schwarz").addEventListener("touchstart", function(){setColor('#000');},false);
	       document.getElementById("rot").addEventListener("touchstart", function(){setColor('#CC3227');},false);
	       document.getElementById("blau").addEventListener("touchstart", function(){setColor('#21A6CC');},false);
	       document.getElementById("rosa").addEventListener("touchstart", function(){setColor('#CC144E');},false);
	       document.getElementById("gruen").addEventListener("touchstart", function(){setColor('#8EFF82');},false);
	       
	       // event listener Touch Buttons
	       document.getElementById("loeschen").addEventListener("touchstart", loeschen ,false);
	       document.getElementById("speichern").addEventListener("touchstart", speichern ,false);

	       
	        
	       // set up drawing context
	       ctx = canvas.getContext("2d");
	       ctx.lineWidth = 25;
	       ctx.strokeStyle = farbe;
	       ctx.lineJoin = 'round';
	       ctx.lineCap = 'round';
	       
	       //Malvorlage
		   vorlage ();
	
	       // kick off draw loop
	       draw();
	
	    }
	    
	    function vorlage () {
		   img = new Image();
	       img.src = malvorlage;
	       ctx.drawImage(img, 50, 50);
	    }
	
	    function downHandler(event) {
	    	ctx.strokeStyle = farbe;
	        points = [];
	        mouseDown = true;
	    }
	
	    function upHandler(event) {
	        mouseDown = false;
	    }
	
	    function moveHandler(event) {
	        if(mouseDown) {
	        	var posLeft = canvas.offsetLeft;
	        	var posTop = canvas.offsetTop;
	            var x = event.touches[0].clientX;
	            var y = event.touches[0].clientY-100;
	
	            // add object to points array
	            points[points.length] = {x: x, y: y};
	            
	        }
	    }
	
	    function draw() {
	        window.requestAnimationFrame(draw);
	        
	       // loop through
	       ctx.beginPath();
	       for(var i=1;i<points.length;i++) {
	         ctx.moveTo(points[i-1].x, points[i-1].y);
	         ctx.lineTo(points[i].x, points[i].y);   
	       }
	       ctx.stroke();
	       
	       //Malvorlage darüber legen
	       vorlage ();
	      
	    }
	    
	    function setColor (far) {
	  		farbe = far;
	  	}
	  	
	  	function loeschen () {
		  	canvas.width = canvas.width;
		  	points = [];
		  	init();
	  	}
	  	
	  	function speichern () {
		  	 var base64 = document.getElementById("canvas").toDataURL('image/png');
	  	}
	  	

  	
	
	    // initialize application
	    init();
	
	})();
    
  </script>

</body>
</html>
